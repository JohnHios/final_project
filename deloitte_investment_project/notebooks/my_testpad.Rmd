---
title: "R Notebook"
output: html_notebook
---

Call Libraries
```{r}
library(tidyverse)
library(janitor)
library(here)
library(readxl)
```

```{r}
# The palette with grey:
cb_palette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# The palette with black:
# cbb_palette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# # The palette with all colours:
cbb_palette <- c("#000000", "#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

# # To use for fills, add
#   scale_fill_manual(values=cbPalette)
# 
# # To use for line and point colors, add
#   scale_colour_manual(values=cbPalette)
```


__Overview of GDP in UK and G7 Countries__

Load Data
```{r}
# read_excel(here("raw_data/International_Labour_Productivity-Europe.xls"), sheet = "Table 2 R-proc")
# read_csv(here("raw_data/Labour_Productivity-OECD_Countries.csv"))
gdp_phw_current <- read_excel(here("raw_data/International_Labour_Productivity-G7.xls"), sheet = "Table 1 R-proc") 
gdp_pw_current <- read_excel(here("raw_data/International_Labour_Productivity-G7.xls"), sheet = "Table 2 R-proc") 
gdp_phw_const <- read_excel(here("raw_data/International_Labour_Productivity-G7.xls"), sheet = "Table 3 R-proc") 
gdp_pw_const <- read_excel(here("raw_data/International_Labour_Productivity-G7.xls"), sheet = "Table 4 R-proc") 


glimpse(gdp_phw_current)
glimpse(gdp_pw_current)
glimpse(gdp_phw_const)
glimpse(gdp_pw_const)
```

Check for NA values
```{r}
gdp_phw_current %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```

```{r}
gdp_pw_current %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```

```{r}
gdp_phw_const %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```


```{r}
gdp_pw_const %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```


Pivot data to long format
```{r}
tidy_gdp_phw_current <- gdp_phw_current %>%
  pivot_longer(-Year, names_to = "Country", values_to = "GDP_phw") %>%
  relocate(Year, .after = Country)

tidy_gdp_pw_current <- gdp_pw_current %>%
  pivot_longer(-Year, names_to = "Country", values_to = "GDP_pw") %>%
  relocate(Year, .after = Country)

tidy_gdp_phw_const <- gdp_phw_const %>%
  pivot_longer(-Year, names_to = "Country", values_to = "GDP_phw") %>%
  relocate(Year, .after = Country)

tidy_gdp_pw_const <- gdp_pw_const %>%
  pivot_longer(-Year, names_to = "Country", values_to = "GDP_pw") %>%
  relocate(Year, .after = Country)

  
 
tidy_gdp_phw_current
tidy_gdp_pw_current
tidy_gdp_phw_const
tidy_gdp_pw_const
```

```{r}
tidy_gdp_phw_current %>% 
  ggplot() +
  aes(x = Year, y = GDP_phw, colour = Country) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)
```


```{r}
tidy_gdp_pw_current %>% 
  ggplot() +
  aes(x = Year, y = GDP_pw, colour = Country) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)
```





```{r}
tidy_gdp_phw_const %>% 
  ggplot() +
  aes(x = Year, y = GDP_phw, colour = Country) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)
```


```{r}
tidy_gdp_pw_const %>% 
  ggplot() +
  aes(x = Year, y = GDP_pw, colour = Country) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)
```


```{r}
gdp_phw_OECD <- read_csv(here("raw_data/Labour_Productivity-OECD_Countries.csv")) 

glimpse(gdp_phw_OECD)
```

Check for NA values
```{r}
gdp_phw_OECD %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```

```{r}
gdp_phw_OECD %>% 
  distinct(LOCATION)
  # distinct(SUBJECT) # TOT
  # distinct(MEASURE) # USD IDX2010
  # distinct(FREQUENCY) #A
  # distinct(`Flag Codes`) # NA	B E
```

```{r}
gdp_phw_OECD %>% 
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT)) %>% 
  filter(LOCATION %in% c("G-7", "EU28", "CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
         MEASURE == "USD") %>% 
  ggplot() +
  aes(x = TIME, y = Value, colour = LOCATION) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)
  
```



```{r}
gdp_phw_OECD %>% 
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT)) %>% 
  filter(LOCATION %in% c("G-7", "EU28", "CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
         MEASURE == "IDX2010") %>% 
  ggplot() +
  aes(x = TIME, y = Value, colour = LOCATION) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)
  
```


```{r}
gdp_phw_OECD %>%
  filter(
    # LOCATION %in% c("G-7", "EU28", "CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
    MEASURE == "USD",
    TIME == 2017
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT, MEASURE, TIME)) %>% 
  ggplot() +
  aes(
    x = reorder(LOCATION, Value), 
    y = Value,
    fill = reorder(LOCATION, Value) == "GBR"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1.15, hjust = 1),
    text = element_text(size = 8)
    )
```


```{r}
gdp_phw_OECD %>%
  filter(
    # LOCATION %in% c("G-7", "EU28", "CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
    MEASURE == "IDX2010",
    TIME == 2017
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT, MEASURE, TIME)) %>% 
  ggplot() +
  aes(
    x = reorder(LOCATION, Value), 
    y = Value,
    fill = reorder(LOCATION, Value) == "GBR"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1.15, hjust = 1),
    text = element_text(size = 8)
    )
```

__Compare productivity by industry in UK and EU Countries__

Load Data
```{r}
productivity_phw <- read_excel(here("raw_data/International_Labour_Productivity-Europe.xls"), sheet = "Table 1 R-proc")
productivity_growth <- read_excel(here("raw_data/International_Labour_Productivity-Europe.xls"), sheet = "Table 2 R-proc")


glimpse(productivity_phw)
glimpse(productivity_growth)
```



Check for NA values
```{r}
productivity_phw %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```


```{r}
productivity_growth %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```



Pivot data to long format
```{r}
tidy_productivity_phw <- productivity_phw %>%
  pivot_longer(-c(`A*10 (excl L)`, `NACE Industry`), names_to = "Country", values_to = "Output_per_hour") 

tidy_productivity_growth <- productivity_growth %>%
  pivot_longer(-c(`A*10 (excl L)`, `NACE Industry`), names_to = "Country", values_to = "Labour_Productivity_Growth") 


tidy_productivity_phw
tidy_productivity_growth
```

```{r}
tidy_productivity_phw %>% 
  filter(
    # `NACE Industry` == "Agriculture, forestry and fishing"
    # `NACE Industry` == "Industry (except construction)"
    # `NACE Industry` == "Construction"
    # `NACE Industry` == "Wholesale and retail trade, transport, accommodation and food service activities"
    `NACE Industry` == "Information and communication"
    # `NACE Industry` == "Financial and insurance activities"
    # `NACE Industry` == "Professional, scientific and technical activities; administrative and support service activities"
    # `NACE Industry` == "Public administration, defence, education, human health and social work activities"
    # `NACE Industry` == "Arts, entertainment and recreation; other service activities"
  ) %>% 
  ggplot() +
  aes(
    x = reorder(Country, Output_per_hour), 
    y = Output_per_hour,
    fill = reorder(Country, Output_per_hour) == "United Kingdom"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
    text = element_text(size = 8)
    )
```


```{r}
tidy_productivity_growth %>% 
  filter(
    # `NACE Industry` == "Agriculture, forestry and fishing"
    # `NACE Industry` == "Industry (except construction)"
    # `NACE Industry` == "Construction"
    # `NACE Industry` == "Wholesale and retail trade, transport, accommodation and food service activities"
    `NACE Industry` == "Information and communication"
    # `NACE Industry` == "Financial and insurance activities"
    # `NACE Industry` == "Professional, scientific and technical activities; administrative and support service activities"
    # `NACE Industry` == "Public administration, defence, education, human health and social work activities"
    # `NACE Industry` == "Arts, entertainment and recreation; other service activities"
  ) %>%  
  ggplot() +
  aes(
    x = reorder(Country, Labour_Productivity_Growth), 
    y = Labour_Productivity_Growth,
    fill = reorder(Country, Labour_Productivity_Growth) == "United Kingdom"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
    text = element_text(size = 8)
    )
```

Comparison with large economies in Europe: UK, France, Germany, Italy, Spain (the Netherlands)
```{r}
tidy_productivity_phw %>% 
  filter(
    Country %in% c("United Kingdom", "France", "Germany")
  ) %>% 
  ggplot() +
  aes(
    x = `A*10 (excl L)`, 
    y = Output_per_hour,
    fill = Country
    ) +
  geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2")
  # scale_fill_manual(values = cbb_palette)
  # scale_fill_manual(values = c('steelblue', 'red'), guide = "none") # +
  # theme(
  #   axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
  #   text = element_text(size = 8)
  #   )
```
```{r}
tidy_productivity_phw %>% 
  distinct(`A*10 (excl L)`, `NACE Industry`)
```


```{r}
tidy_productivity_growth %>% 
  filter(
    Country %in% c("United Kingdom", "Germany")
  ) %>% 
  ggplot() +
  aes(
    x = `A*10 (excl L)`, 
    y = Labour_Productivity_Growth,
    fill = Country
    ) +
  geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2")
  # scale_fill_manual(values = cbb_palette)
  # scale_fill_manual(values = c('steelblue', 'red'), guide = "none") # +
  # theme(
  #   axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
  #   text = element_text(size = 8)
  #   )
```



Comparison with most productive countries in Europe (2017): UK, Ireland, Norway
```{r}
tidy_productivity_phw %>% 
  filter(
    Country %in% c("United Kingdom", "Ireland", "Norway")
  ) %>% 
  ggplot() +
  aes(
    x = `A*10 (excl L)`, 
    y = Output_per_hour,
    fill = Country
    ) +
  geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2")
  # scale_fill_manual(values = cbb_palette)
  # scale_fill_manual(values = c('steelblue', 'red'), guide = "none") # +
  # theme(
  #   axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
  #   text = element_text(size = 8)
  #   )
```



__Compare  investment between UK and other countries__


Cross country infrastructure investment

Read data
```{r}
infrastructure_investment <- read_excel(here("raw_data/Cross_country_infrastructure_investment.xls")) 

glimpse(infrastructure_investment)
```

```{r}
infrastructure_investment %>% 
  # distinct(LOCATION)
  # distinct(INDICATOR) # INFRAINVEST
  distinct(SUBJECT) #
  # distinct(MEASURE) # EUR, PC_GDP
  # distinct(FREQUENCY) #A
  # distinct(`Flag Codes`) # NA, B, P, E, M
```

```{r}
infrastructure_investment %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```

```{r}
infrastructure_investment %>% 
  filter(is.na(Value))
```

```{r}
infrastructure_investment %>%
  filter(
    # LOCATION %in% c("G-7", "EU28", "CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
    SUBJECT == "RAIL",
    # SUBJECT == "ROAD",
    # SUBJECT == "SEA",
    # SUBJECT == "AIR",
    # SUBJECT == "INLANDWATER",
    MEASURE == "EUR",
    TIME == 2016
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT, MEASURE, TIME)) %>% 
  ggplot() +
  aes(
    x = reorder(LOCATION, Value), 
    y = Value,
    fill = reorder(LOCATION, Value) == "GBR"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1.15, hjust = 1),
    text = element_text(size = 8)
    )
```



```{r}
infrastructure_investment %>%
  filter(
    # LOCATION %in% c("G-7", "EU28", "CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
    SUBJECT == "INLAND",
    MEASURE == "PC_GDP", # "EUR",
    TIME == 2016
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT, MEASURE, TIME)) %>% 
  ggplot() +
  aes(
    x = reorder(LOCATION, Value), 
    y = Value,
    fill = reorder(LOCATION, Value) == "GBR"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1.15, hjust = 1),
    text = element_text(size = 8)
    )
```

Comparison with large economies in Europe: UK, France, Germany, Italy, Spain (the Netherlands)
```{r}
infrastructure_investment %>% 
  filter(
    LOCATION %in% c("GBR", "FRA", "DEU"),
    MEASURE == "EUR", #"PC_GDP", # 
    TIME == 2016
  ) %>% 
  ggplot() +
  aes(
    x = SUBJECT, 
    y = Value,
    fill = LOCATION
    ) +
  geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2")
  # scale_fill_manual(values = cbb_palette)
  # scale_fill_manual(values = c('steelblue', 'red'), guide = "none") # +
  # theme(
  #   axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
  #   text = element_text(size = 8)
  #   )
```


Comparison with most productive countries in Europe (2017): UK, Ireland, Norway
```{r}
infrastructure_investment %>% 
  filter(
    LOCATION %in% c("GBR", "IRL", "NOR"),
    MEASURE == "EUR", #"PC_GDP", # 
    TIME == 2015
  ) %>% 
  ggplot() +
  aes(
    x = SUBJECT, 
    y = Value,
    fill = LOCATION
    ) +
  geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2")
  # scale_fill_manual(values = cbb_palette)
  # scale_fill_manual(values = c('steelblue', 'red'), guide = "none") # +
  # theme(
  #   axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
  #   text = element_text(size = 8)
  #   )
```


Cross Country Gross Domestic Spending on R&D

Read data
```{r}
gdexp_rd <- read_excel(here("raw_data/Cross_country_Gross_Domestic_Spending_on_R&D.xls")) 

glimpse(gdexp_rd)
```

```{r}
gdexp_rd %>% 
  distinct(LOCATION)
  # distinct(INDICATOR) # GDEXPRD
  # distinct(SUBJECT) # TOT
  # distinct(MEASURE) # MLN_USD, PC_GDP
  # distinct(FREQUENCY) #A
  # distinct(`Flag Codes`) # NA
```
Check for NA's
```{r}
gdexp_rd %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```

G-7 countries gross domestic expenditure on R&D (Million USD)
```{r}
gdexp_rd %>%
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT)) %>%
  filter(LOCATION %in% c("CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
         MEASURE == "MLN_USD") %>%
  ggplot() +
  aes(x = TIME, y = Value, colour = LOCATION) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)

```

G-7 countries gross domestic expenditure on R&D (% GDP)
```{r}
gdexp_rd %>%
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT)) %>%
  filter(LOCATION %in% c("CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
         MEASURE == "PC_GDP") %>%
  ggplot() +
  aes(x = TIME, y = Value, colour = LOCATION) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)

```



```{r}
gdexp_rd %>%
  filter(
    # LOCATION %in% c("G-7", "EU28", "CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
    MEASURE == "PC_GDP",
    TIME == 2016
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT, MEASURE, TIME)) %>% 
  ggplot() +
  aes(
    x = reorder(LOCATION, Value), 
    y = Value,
    fill = reorder(LOCATION, Value) == "GBR"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1.15, hjust = 1),
    text = element_text(size = 8)
    )
```


```{r}
gdexp_rd %>%
  filter(
    # LOCATION %in% c("G-7", "EU28", "CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
    MEASURE == "MLN_USD",
    TIME == 2016
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT, MEASURE, TIME)) %>% 
  ggplot() +
  aes(
    x = reorder(LOCATION, Value), 
    y = Value,
    fill = reorder(LOCATION, Value) == "GBR"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1.15, hjust = 1),
    text = element_text(size = 8)
    )
```



__Comparison of Private Sector In Economy__

Read data
```{r}
private_sector <- read_excel(here("raw_data/Private_Sector_In_Economy.xlsx"), sheet = "5.1_Private_sector R-proc") 

glimpse(private_sector)
```

Check for NA's
```{r}
private_sector %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```

Remove junk and change data type to numeric in all columns except `Country` and turn ICT variables to millions of USD
```{r}
private_sector_clean <- private_sector %>%
  select(-c(`Businesses registered New 2016`, `Businesses registered Entry density 2016`)) %>% 
  mutate(
    across(
      .cols = where(is.character) & !Country, 
      .fns = ~as.numeric(.x)
    )
  ) %>% 
  mutate(
    `ICT $ 2006-11` = `ICT $ 2006-11`/1000000,
    `ICT $ 2012-17` = `ICT $ 2012-17`/1000000
  )
  
glimpse(private_sector_clean)
```



Pivot data to long format
```{r}
private_sector_investment <- private_sector_clean %>%
  select(-c(`Domestic credit % of GDP 2006-11`, `Domestic credit % of GDP 2012-17`)) %>% 
  pivot_longer(
    cols = -Country,
    names_to = "sector",
    values_to = "mln_usd"
  ) %>% 
  mutate(
    period = str_sub(sector, -7),
    sector = str_remove(sector, pattern = " \\$.*")
  ) %>% 
  relocate(period, .after = sector) %>% 
  clean_names()

private_sector_investment
```

```{r}
domestic_credit_to_private_sector <- private_sector_clean %>%
  select(`Country`, `Domestic credit % of GDP 2006-11`, `Domestic credit % of GDP 2012-17`) %>% 
  pivot_longer(
    cols = -Country,
    names_to = "period",
    values_to = "gdp_pc"
  ) %>% 
  mutate(
    period = str_sub(period, -7)
  ) %>% 
  clean_names()

domestic_credit_to_private_sector
```



```{r}
private_sector_investment %>% 
  distinct(country)
```



```{r}
domestic_credit_to_private_sector %>%
  filter(
    country %in% c("Canada", "France", "Germany", "Italy", "Japan", "United States", "United Kingdom")
  ) %>% 
  ggplot() +
  aes(x = country, y = gdp_pc, fill  = period) +
  geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2") +
  theme(
    axis.text.x = element_text(angle = 30, vjust = 0.75)
    )
  
```



__Compare skills and education between UK and other countries__


OECD Adult Education Levels

Read data
```{r}
adult_education <- read_excel(here("raw_data/OECD_Adult_Education_Levels.xlsx")) 

glimpse(adult_education)
```


Check for NA's
```{r}
adult_education %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```


```{r}
adult_education %>% 
  distinct(LOCATION)
  # distinct(INDICATOR) # EDUADULT
  # distinct(SUBJECT) # TRY
  # distinct(MEASURE) # PC_25_64
  # distinct(FREQUENCY) #A
  # distinct(`Flag Codes`) # NA
```


G-7 countries adult education levels 25-64
```{r}
adult_education %>%
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT, MEASURE)) %>%
  filter(LOCATION %in% c("CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR")) %>%
  ggplot() +
  aes(x = TIME, y = Value, colour = LOCATION) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)

```

```{r}
adult_education %>%
  filter(
    TIME == 2017
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, SUBJECT, MEASURE, TIME)) %>% 
  ggplot() +
  aes(
    x = reorder(LOCATION, Value), 
    y = Value,
    fill = reorder(LOCATION, Value) == "GBR"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(size = 6, angle = 45, vjust = 1, hjust = 1)
    )
```

OECD Quality of human capital

Read data
```{r}
overqualified_workers <- read_excel(here("raw_data/OECD_Quality_of_human_capital.xlsx"), sheet = "Prop Workers Overqualified R-pr") 
underqualified_workers <- read_excel(here("raw_data/OECD_Quality_of_human_capital.xlsx"), sheet = "Prop Worker Underqualified R-pr") 
qualified_workers <- read_excel(here("raw_data/OECD_Quality_of_human_capital.xlsx"), sheet = "Prop Workers Well-matched R-pr") 

glimpse(overqualified_workers)
glimpse(underqualified_workers)
glimpse(qualified_workers)
```

Change data type to numeric in all columns except `Country` 
```{r}
overqualified_workers_clean <- overqualified_workers %>%
  mutate(
    across(
      .cols = where(is.character) & !Country, 
      .fns = ~as.numeric(.x)
    )
  )


underqualified_workers_clean <- underqualified_workers %>%
  mutate(
    across(
      .cols = where(is.character) & !Country, 
      .fns = ~as.numeric(.x)
    )
  )


qualified_workers_clean <- qualified_workers %>%
  mutate(
    across(
      .cols = where(is.character) & !Country, 
      .fns = ~as.numeric(.x)
    )
  )

glimpse(overqualified_workers_clean)
glimpse(underqualified_workers_clean)
glimpse(qualified_workers_clean)
```


Check for NA's
```{r}
overqualified_workers_clean %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```

```{r}
underqualified_workers_clean %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```


```{r}
qualified_workers_clean %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```



Pivot data to long format
```{r}
tidy_overqualified_workers <- overqualified_workers_clean %>%
  pivot_longer(
    cols = -Country,
    names_to = "year",
    values_to = "percentage"
  )  %>% 
  clean_names()


tidy_underqualified_workers <- underqualified_workers_clean %>%
  pivot_longer(
    cols = -Country,
    names_to = "year",
    values_to = "percentage"
  )  %>% 
  clean_names()


tidy_qualified_workers <- qualified_workers_clean %>%
  pivot_longer(
    cols = -Country,
    names_to = "year",
    values_to = "percentage"
  )  %>% 
  clean_names()



tidy_overqualified_workers
tidy_underqualified_workers
tidy_qualified_workers
```

Comparison with large economies in Europe: UK, France, Germany, Italy, Spain (the Netherlands)
```{r}
tidy_overqualified_workers %>%
  filter(
    country %in% c("France", "Germany", "Italy", "Spain", "United Kingdom")
  ) %>% 
  ggplot() +
  aes(x = year, y = percentage, group = country, colour = country) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)
```

```{r}
tidy_underqualified_workers %>%
  filter(
    country %in% c("France", "Germany", "Italy", "Spain", "United Kingdom")
  ) %>% 
  ggplot() +
  aes(x = year, y = percentage, group = country, colour = country) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)
```


```{r}
tidy_qualified_workers %>%
  filter(
    country %in% c("France", "Germany", "Italy", "Spain", "United Kingdom")
  ) %>% 
  ggplot() +
  aes(x = year, y = percentage, group = country, colour = country) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)
```


Comparison with all countries in Europe
```{r}
tidy_overqualified_workers %>%
  filter(
    year == 2013
    ) %>%  
  ggplot() +
  aes(
    x = reorder(country, percentage), 
    y = percentage,
    fill = reorder(country, percentage) == "United Kingdom"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(size = 6, angle = 45, vjust = 1, hjust = 1)
    )
```

```{r}
tidy_underqualified_workers %>%
  filter(
    year == 2013
    ) %>%  
  ggplot() +
  aes(
    x = reorder(country, percentage), 
    y = percentage,
    fill = reorder(country, percentage) == "United Kingdom"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(size = 6, angle = 45, vjust = 1, hjust = 1)
    )
```


```{r}
tidy_qualified_workers %>%
  filter(
    year == 2013
    ) %>%  
  ggplot() +
  aes(
    x = reorder(country, percentage), 
    y = percentage,
    fill = reorder(country, percentage) == "United Kingdom"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(size = 6, angle = 45, vjust = 1, hjust = 1)
    )
```


OECD Tertiary Spending Expenditure


Read data
```{r}
education_expenditure <- read_excel(here("raw_data/OECD_Tertiary_Education_Expenditure.xlsx")) 

glimpse(education_expenditure)
```


Check for NA's
```{r}
education_expenditure %>% 
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))
```


```{r}
education_expenditure %>% 
  # distinct(LOCATION)
  # distinct(INDICATOR) # EDUPUBEXP
  # distinct(SUBJECT) # TRY, PRY_NTRY, PRY_TRY
  # distinct(MEASURE) # PC_GDP
  # distinct(FREQUENCY) #A
  distinct(`Flag Codes`) # NA, M
```


G-7 countries education expenditure (GDP percentage)
TRY : TeRtiarY
PRY_NTRY: PRimarY to Non-TeRtiarY
PRY_TRY: PRimarY to TeRtiarY
```{r}
education_expenditure %>%
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, MEASURE)) %>%
  filter(
    LOCATION %in% c("CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
    SUBJECT == "TRY"
    ) %>%
  ggplot() +
  aes(x = TIME, y = Value, colour = LOCATION) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)

```

```{r}
education_expenditure %>%
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, MEASURE)) %>%
  filter(
    LOCATION %in% c("CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
    SUBJECT == "PRY_TRY"
    ) %>%
  ggplot() +
  aes(x = TIME, y = Value, colour = LOCATION) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)

```

```{r}
education_expenditure %>%
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, MEASURE)) %>%
  filter(
    LOCATION %in% c("CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
    SUBJECT == "PRY_NTRY"
    ) %>%
  ggplot() +
  aes(x = TIME, y = Value, colour = LOCATION) +
  geom_line(size = 0.75) +
  geom_point(size = 1.5) +
  # scale_colour_brewer(palette = "Dark2")
  scale_colour_manual(values = cbb_palette)

```


```{r}
education_expenditure %>%
  filter(
    TIME == 2015,
    SUBJECT == "TRY"
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, MEASURE, TIME)) %>% 
  ggplot() +
  aes(
    x = reorder(LOCATION, Value), 
    y = Value,
    fill = reorder(LOCATION, Value) == "GBR"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(size = 6, angle = 45, vjust = 1, hjust = 1)
    )
```



```{r}
education_expenditure %>%
  filter(
    TIME == 2015,
    SUBJECT == "PRY_TRY"
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, MEASURE, TIME)) %>% 
  ggplot() +
  aes(
    x = reorder(LOCATION, Value), 
    y = Value,
    fill = reorder(LOCATION, Value) == "GBR"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(size = 6, angle = 45, vjust = 1, hjust = 1)
    )
```



```{r}
education_expenditure %>%
  filter(
    TIME == 2015,
    SUBJECT == "PRY_NTRY"
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, MEASURE, TIME)) %>% 
  ggplot() +
  aes(
    x = reorder(LOCATION, Value), 
    y = Value,
    fill = reorder(LOCATION, Value) == "GBR"
    ) +
  geom_col() +
  scale_fill_manual(values = c('steelblue', 'red'), guide = "none") +
  theme(
    axis.text.x = element_text(size = 6, angle = 45, vjust = 1, hjust = 1)
    )
```


```{r}
education_expenditure %>%
  filter(
    LOCATION %in% c("CAN", "FRA", "DEU", "ITA", "JPN", "USA", "GBR"),
    TIME == 2015
    ) %>%  
  select(-c(`Flag Codes`, INDICATOR, FREQUENCY, MEASURE)) %>% 
  ggplot() +
  aes(x = LOCATION, y = Value, fill = SUBJECT) +
  geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2")
```
TRY : TeRtiarY
PRY_NTRY: PRimarY to Non-TeRtiarY
PRY_TRY: PRimarY to TeRtiarY




























